<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ” Thronedis Gate â€” à¸‚à¸­à¸šà¸„à¸¸à¸“ Holder | Multiâ€‘Wallet (IDs 0â€“10)</title>

  <!-- Ethers -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <!-- Web3Modal (WalletConnect v2) -->
  <script src="https://unpkg.com/@web3modal/standalone@2.7.2/dist/index.umd.js"></script>

  <style>
    :root { --bg:#0b0f14; --panel:#0f172a; --muted:#93a3b8; --brand:#2563eb; --ok:#16a34a; --bad:#ef4444; }
    * { box-sizing:border-box }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:#e9f0f4; margin:0; padding:24px; }
    a { color:#67e8f9; font-weight:600; text-decoration:none }
    .wrap { max-width:880px; margin:0 auto; }
    .card { background:var(--panel); border:1px solid #1f2937; border-radius:14px; padding:18px; margin-top:20px; }
    .muted { color:var(--muted); }
    code { background:#111827; padding:2px 6px; border-radius:6px }
    .btn-row { display:flex; gap:12px; flex-wrap:wrap; margin-top:10px; }
    button { padding:10px 16px; border-radius:10px; border:0; cursor:pointer; background:var(--brand); color:white }
    .btn-secondary { background:#334155; }
    .btn-danger { background:#ef4444; }
    .thanks { text-align:center; background:#0f172a; border:1px solid #1f2937; border-radius:12px; padding:12px; margin-bottom:14px; }
    .badge { display:inline-block; padding:4px 8px; border-radius:999px; font-size:12px; }
    .ok { background:rgba(22,163,74,.15); color:#86efac; }
    .bad { background:rgba(239,68,68,.15); color:#fecaca; }
    .warn{ background:rgba(234,179,8,.15); color:#fde68a; }
    #secret { display:none; }
  </style>
</head>
<body>
<div class="wrap">
  <div class="thanks">ğŸ’– à¸‚à¸­à¸šà¸„à¸¸à¸“ <b>Holder</b> à¸—à¸¸à¸à¸—à¹ˆà¸²à¸™à¸—à¸µà¹ˆà¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™à¹‚à¸›à¸£à¹€à¸ˆà¸à¸•à¹Œà¸™à¸µà¹‰! ğŸ’–</div>

  <h2>ğŸ” Thronedis â€“ Token Gated (à¹€à¸à¸´à¹ˆà¸¡/à¸ªà¸¥à¸±à¸šà¸«à¸¥à¸²à¸¢à¸à¸£à¸°à¹€à¸›à¹‹à¸²)</h2>
  <div class="muted">
    Polygon (137) Â· Collection: <code>0x76f4E59DBBF99D025B6F1014D33843AB138e4085</code> Â· Allowed IDs: <code>0â€“10</code>
  </div>

  <!-- Status -->
  <div class="card" id="status">
    <div><b>Status:</b> <span id="status-text" class="badge warn">Not connected</span></div>
    <div class="muted" style="margin-top:6px">
      <div>Address: <code id="s-addr">â€“</code></div>
      <div>Chain: <code id="s-chain">â€“</code></div>
      <div>Standard detected: <code id="s-std">â€“</code></div>
      <div>Matched tokenId: <code id="s-hit">â€“</code></div>
      <div>Last error: <code id="s-err">â€“</code></div>
    </div>
  </div>

  <div id="locked" class="card">
    <p>à¸•à¹‰à¸­à¸‡à¸–à¸·à¸­ NFT à¸—à¸µà¹ˆ <strong>Token ID 0â€“10</strong> à¹ƒà¸™à¸„à¸­à¸¥à¹€à¸¥à¹‡à¸à¸Šà¸±à¸™à¸™à¸µà¹‰à¸ˆà¸¶à¸‡à¸ˆà¸°à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸à¹„à¸”à¹‰</p>
    <div class="btn-row">
      <button id="btn-universal">ğŸ‘œ Connect / Add Wallet (Universal)</button>
      <button id="btn-metamask" class="btn-secondary">ğŸ¦Š Add MetaMask (Desktop)</button>
      <a id="btn-mm-app" class="btn-secondary" style="display:inline-block; padding:10px 16px; border-radius:10px; background:#475569; color:white" target="_blank" rel="noopener">
        ğŸ“² Open in MetaMask App
      </a>
      <button id="btn-clear" class="btn-danger">ğŸ§¹ Clear Connected</button>
    </div>
    <p class="muted" style="margin-top:10px;">à¸à¸” â€œUniversalâ€ à¹€à¸à¸·à¹ˆà¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸§à¸­à¸¥à¹€à¸¥à¹‡à¸•à¸œà¹ˆà¸²à¸™ WalletConnect (à¸¡à¸·à¸­à¸–à¸·à¸­/à¹€à¸”à¸ªà¸à¹Œà¸—à¹‡à¸­à¸›)</p>
  </div>

  <div id="secret" class="card">
    <h3>ğŸ‰ à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¹„à¸”à¹‰à¹à¸¥à¹‰à¸§</h3>
    <p>à¸‚à¸­à¸šà¸„à¸¸à¸“ Holder à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™ ğŸ’–</p>
    <!-- Test Link à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸‚à¸­ (web3.storage gateway) -->
    <p><a href="https://bafybeigsrytimlmv4dkz2px7ke4bwco4qj2kgxsdaeaxgmvkubiuexh5cu.ipfs.w3s.link" target="_blank">ğŸ‘‰ Test Link (IPFS)</a></p>
    <!-- à¸ªà¸³à¸£à¸­à¸‡à¸œà¹ˆà¸²à¸™ ipfs.io -->
    <p class="muted">à¸ªà¸³à¸£à¸­à¸‡: <a href="https://ipfs.io/ipfs/bafybeigsrytimlmv4dkz2px7ke4bwco4qj2kgxsdaeaxgmvkubiuexh5cu" target="_blank">ipfs.io gateway</a></p>
  </div>
</div>

<script>
  // ===== CONFIG =====
  const CONTRACT_ADDRESS = "0x76f4E59DBBF99D025B6F1014D33843AB138e4085";
  const NETWORK_HEX = "0x89"; // Polygon Mainnet
  const TOKEN_IDS = ["0","1","2","3","4","5","6","7","8","9","10"];
  const WALLETCONNECT_PROJECT_ID = "ba3a040708c3e27acefb4eb4b3c5d9a8";
  // ===================

  const IID_ERC721  = "0x80ac58cd";
  const IID_ERC1155 = "0xd9b67a26";
  const ABI_ERC165  = ["function supportsInterface(bytes4 interfaceId) view returns (bool)"];
  const ABI_ERC721  = ["function ownerOf(uint256 tokenId) view returns (address)"];
  const ABI_ERC1155 = ["function balanceOf(address account, uint256 id) view returns (uint256)"];

  // UI helpers
  const sText = document.getElementById("status-text");
  const sAddr = document.getElementById("s-addr");
  const sChain= document.getElementById("s-chain");
  const sStd  = document.getElementById("s-std");
  const sHit  = document.getElementById("s-hit");
  const sErr  = document.getElementById("s-err");
  const secret= document.getElementById("secret");
  const locked= document.getElementById("locked");

  function setStatus(kind, text) {
    sText.className = "badge " + (kind==="ok"?"ok": kind==="bad"?"bad":"warn");
    sText.textContent = text;
  }

  // Deep link (MetaMask mobile)
  const currentUrl = location.href.replace(/^https?:\/\//,'').replace(/\/+/g,'/');
  document.getElementById("btn-mm-app").href = "https://metamask.app.link/dapp/" + currentUrl;

  async function ensurePolygon(provider) {
    const chainId = await provider.request({ method: "eth_chainId" });
    sChain.textContent = chainId;
    if (chainId !== NETWORK_HEX) {
      await provider.request({
        method: "wallet_switchEthereumChain",
        params: [{ chainId: NETWORK_HEX }]
      });
      sChain.textContent = NETWORK_HEX;
    }
  }

  async function detectStandard(provider) {
    const web3p = new ethers.providers.Web3Provider(provider);
    const c165 = new ethers.Contract(CONTRACT_ADDRESS, ABI_ERC165, web3p);
    try {
      const is721  = await c165.supportsInterface(IID_ERC721);
      const is1155 = await c165.supportsInterface(IID_ERC1155);
      if (is1155) return "ERC1155";
      if (is721)  return "ERC721";
    } catch(e) {}
    return "ERC721";
  }

  async function verifyWithProvider(provider, sourceName) {
    try {
      setStatus("warn","Checkingâ€¦");
      await ensurePolygon(provider);
      const accounts = await provider.request({ method: "eth_requestAccounts" });
      const account = accounts[0];
      sAddr.textContent = account;

      const web3p = new ethers.providers.Web3Provider(provider);
      const signer = web3p.getSigner();
      const standard = await detectStandard(provider);
      sStd.textContent = standard;

      let hasAccess = false;
      let hit = null;

      if (standard === "ERC721") {
        const c = new ethers.Contract(CONTRACT_ADDRESS, ABI_ERC721, signer);
        for (const id of TOKEN_IDS) {
          try {
            const owner = await c.ownerOf(id);
            if (owner && owner.toLowerCase() === account.toLowerCase()) { hasAccess = true; hit = id; break; }
          } catch(_) {} // id à¸¢à¸±à¸‡à¹„à¸¡à¹ˆ mint
        }
      } else {
        const c = new ethers.Contract(CONTRACT_ADDRESS, ABI_ERC1155, signer);
        for (const id of TOKEN_IDS) {
          try {
            const bal = await c.balanceOf(account, id);
            if (bal && ethers.BigNumber.from(bal).gt(0)) { hasAccess = true; hit = id; break; }
          } catch(_) {}
        }
      }

      sHit.textContent = hit ?? "â€“";
      if (hasAccess) {
        setStatus("ok","Unlocked");
        locked.style.display = "none";
        secret.style.display = "block";
      } else {
        setStatus("bad","No access");
        locked.style.display = "block";
        secret.style.display = "none";
        alert("âŒ à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸ªà¸´à¸—à¸˜à¸´à¹Œ (à¸•à¹‰à¸­à¸‡à¸–à¸·à¸­ Token ID 0â€“10)");
      }
    } catch (err) {
      console.error(err);
      sErr.textContent = (err && err.message) ? err.message : String(err);
      setStatus("bad","Error");
      alert("à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸´à¸—à¸˜à¸´à¹Œ à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹ƒà¸™ Status");
    }
  }

  // MetaMask (Desktop)
  document.getElementById("btn-metamask").addEventListener("click", async () => {
    if (!window.ethereum) { alert("à¹„à¸¡à¹ˆà¸à¸š MetaMask (à¸¥à¸­à¸‡à¸›à¸¸à¹ˆà¸¡ Universal à¸«à¸£à¸·à¸­à¹€à¸›à¸´à¸”à¸”à¹‰à¸§à¸¢ MetaMask App)"); return; }
    await verifyWithProvider(window.ethereum, "MetaMask");
  });

  // Web3Modal (WalletConnect v2) â€” Universal button
  const w3m = window.Web3ModalStandalone;
  let modal = null;
  function ensureWeb3Modal() {
    if (!modal) {
      modal = w3m.default({
        projectId: WALLETCONNECT_PROJECT_ID,
        themeMode: "dark",
        walletConnectVersion: 2
      });
    }
    return modal;
  }
  document.getElementById("btn-universal").addEventListener("click", async () => {
    const m = ensureWeb3Modal();
    const provider = await m.connect();
    await verifyWithProvider(provider, "WalletConnect");
  });

  // Clear UI
  document.getElementById("btn-clear").addEventListener("click", () => {
    sAddr.textContent = "â€“"; sChain.textContent="â€“"; sStd.textContent="â€“";
    sHit.textContent="â€“"; sErr.textContent="â€“"; setStatus("warn","Not connected");
    locked.style.display = "block"; secret.style.display = "none";
  });
</script>
</body>
</html>