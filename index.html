<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üîë Thronedis ‚Äì Token Gated (‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì Holder)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { background:#0d1117; color:#f0f6fc; font-family:Arial, sans-serif; margin:0; padding:20px; }
    h1 { color:#ffd700; }
    .card { background:#161b22; border-radius:12px; padding:20px; margin:15px 0; }
    button { margin:6px 0; padding:10px 16px; border:none; border-radius:8px; cursor:pointer; font-size:15px; }
    .mm { background:#ff6a00; color:#fff; }
    .wc { background:#9156f9; color:#fff; }
    .clear { background:#e63946; color:#fff; }
    .copy { background:#2d6a4f; color:#fff; margin-left:8px; }
    .link-box { display:flex; align-items:center; }
    .hidden { display:none; }
  </style>
</head>
<body>
  <div class="link-box">
    <strong>üîó ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong>&nbsp;
    <span id="pageUrl"></span>
    <button class="copy" onclick="copyUrl()">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
  </div>

  <h1>üîë Thronedis ‚Äì Token Gated <small>(‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì Holder)</small></h1>
  <p>Polygon (137) ¬∑ Collection: <code>0x76f4E59DBBF99D025B6F1014D33843AB138e4085</code><br/>
     ¬∑ Allowed IDs: 0‚Äì10</p>

  <div class="card">
    <p><b>Status:</b> <span id="status">Not connected</span></p>
    <p>Address: <span id="addr">-</span><br/>
       Chain: <span id="chain">-</span><br/>
       Matched tokenId: <span id="tid">-</span></p>
  </div>

  <div class="card">
    <p>‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏∑‡∏≠ NFT ‡∏ó‡∏µ‡πà Token ID 0‚Äì10 ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏î‡πâ</p>
    <button class="mm" onclick="connectMetaMask()">ü¶ä Connect MetaMask</button><br/>
    <button class="wc" onclick="connectWalletConnect()">üëú Connect WalletConnect</button><br/>
    <button class="clear" onclick="clearConn()">üßπ Clear Connected</button>
  </div>

  <div id="unlocked" class="card hidden">
    <h3>üéâ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</h3>
    <p>‡∏Å‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏•‡∏¥‡∏á‡∏Å‡πå:</p>
    <ul>
      <li><a href="https://bafybeigsrytimlmv4dkz2px7ke4bwco4qj2kgxsdaeaxgmvkubiuexh5cu.ipfs.w3s.link" target="_blank">IPFS ‚Äì Test Link</a></li>
      <li><a href="https://cloudflare-ipfs.com/ipfs/bafybeigsrytimlmv4dkz2px7ke4bwco4qj2kgxsdaeaxgmvkubiuexh5cu" target="_blank">IPFS (Cloudflare)</a></li>
      <li><a href="https://1drv.ms/u/s!test_onedrive_link" target="_blank">OneDrive Download</a></li>
    </ul>
  </div>

<script type="module">
import { ethers } from "https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.esm.min.js";
import WalletConnectProvider from "https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.9.0/dist/index.min.js";

const CONTRACT_ADDR = "0x76f4E59DBBF99D025B6F1014D33843AB138e4085";
const ABI = [
  "function ownerOf(uint256 tokenId) view returns (address)"
];
const ALLOWED = Array.from({length:11},(_,i)=>i); // 0‚Äì10

let provider, signer, addr;

document.getElementById("pageUrl").textContent = window.location.href;

function copyUrl(){
  navigator.clipboard.writeText(window.location.href);
  alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß!");
}

async function connectMetaMask(){
  if(window.ethereum){
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    addr = await signer.getAddress();
    updateUI();
    checkNFT();
  } else {
    // fallback deeplink to MetaMask app
    const url = "https://metamask.app.link/dapp/" + window.location.href.replace(/^https?:\/\//,"");
    window.location.href = url;
  }
}

async function connectWalletConnect(){
  const wc = await WalletConnectProvider.init({
    projectId: "ba3a040708c3e27acefb4eb4b3c5d9a8", // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    chains:[137],
    optionalChains:[1],
    showQrModal:true
  });
  await wc.enable();
  provider = new ethers.providers.Web3Provider(wc);
  signer = provider.getSigner();
  addr = await signer.getAddress();
  updateUI();
  checkNFT();
}

function clearConn(){
  provider=null; signer=null; addr=null;
  document.getElementById("status").textContent="Not connected";
  document.getElementById("addr").textContent="-";
  document.getElementById("chain").textContent="-";
  document.getElementById("tid").textContent="-";
  document.getElementById("unlocked").classList.add("hidden");
}

async function updateUI(){
  document.getElementById("status").textContent="Connected";
  document.getElementById("addr").textContent=addr;
  const net = await provider.getNetwork();
  document.getElementById("chain").textContent=net.chainId;
}

async function checkNFT(){
  const net = await provider.getNetwork();
  if(net.chainId !==137){
    try{
      await provider.send("wallet_switchEthereumChain", [{ chainId: "0x89"}]);
    }catch(e){
      if(e.code===4902){
        await provider.send("wallet_addEthereumChain",[{
          chainId:"0x89",
          rpcUrls:["https://polygon-rpc.com/"],
          chainName:"Polygon",
          nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},
          blockExplorerUrls:["https://polygonscan.com/"]
        }]);
      }
    }
  }
  const c = new ethers.Contract(CONTRACT_ADDR, ABI, provider);
  for(let id of ALLOWED){
    try{
      const owner = await c.ownerOf(id);
      if(owner.toLowerCase()===addr.toLowerCase()){
        document.getElementById("tid").textContent=id;
        document.getElementById("unlocked").classList.remove("hidden");
        return;
      }
    }catch{}
  }
  alert("‡πÑ‡∏°‡πà‡∏°‡∏µ NFT ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î");
}
</script>
</body>
</html>
