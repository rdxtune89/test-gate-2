<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üîí Token‚ÄëGated Download ‚Äî ERC‚Äë721 (Polygon)</title>

  <!-- Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <!-- WalletConnect (v2) UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.11.1/dist/index.umd.min.js"></script>

  <style>
    :root { --card:#0b1220; --ink:#e6ecff; --muted:#9fb0ff; --ok:#22c55e; --err:#f43f5e; --edge:#1f2a44; --warn:#eab308; }
    *{ box-sizing:border-box; }
    body{ margin:0; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Arial; background: radial-gradient(1200px 600px at 10% -10%,#13203d 0,#0b1220 50%,#090f1a 100%); color:var(--ink); }
    .wrap{ max-width: 920px; margin: 40px auto; padding: 0 16px; }
    .card{ background: linear-gradient(180deg,#0f1830,#0b1220); border:1px solid var(--edge); border-radius: 16px; padding: 22px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    h1{ margin: 0 0 10px; font-size: 22px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; margin: 14px 0; align-items:center; }
    button, .btn{
      appearance:none; border:1px solid var(--edge); background:#121b33; color:var(--ink);
      padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600;
    }
    button:hover,.btn:hover{ filter:brightness(1.08); }
    .pill{ display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid var(--edge); color:var(--muted); font-size:12px }
    .status{ margin-top:10px; font-size:14px; color:var(--muted); }
    .ok{ color:var(--ok); font-weight:700 }
    .err{ color:var(--err); font-weight:700 }
    .gate{ margin-top:16px; padding:16px; border:1px dashed var(--edge); border-radius: 12px; text-align:center; }
    .hidden{ display:none; }
    .linkbox{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
    a.btn{ text-decoration:none; }
    .hint{ color:#8ea0ff; font-size:12px; margin-top:8px }
    code{ background:#0f1830; padding:2px 6px; border-radius:6px; border:1px solid var(--edge) }
    .warn-strong{ font-weight:800; color:var(--warn); }
    .spacer{ flex:1 1 auto; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="row">
        <h1 id="title">üîí ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠ ‚Äî ERC‚Äë721</h1>
        <div class="spacer"></div>
        <button id="langBtn" aria-label="toggle language">EN</button>
      </div>

      <div class="row">
        <span class="pill" id="pillNet">Network: Polygon (137 / 0x89)</span>
        <span class="pill">Contract A: <code>0xefc87d60fc234d87286d41c5143b25c1abf38477</code></span>
        <span class="pill">Contract B: <code>0x76f4E59DBBF99D025B6F1014D33843AB138e4085</code></span>
        <span class="pill" id="pillStd">ERC‚Äë721 only</span>
      </div>

      <div class="row">
        <button id="connectMeta">Connect with MetaMask</button>
        <button id="connectWC">Connect with WalletConnect</button>
      </div>

      <div id="status" class="status">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</div>

      <div id="locked" class="gate">
        <strong class="err" id="lockedTitle">Locked</strong>
        <div class="hint" id="hintReq">
          ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏∑‡∏≠ NFT ‡∏à‡∏≤‡∏Å <b>‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡πÉ‡∏î‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á</b> (ERC‚Äë721) ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
        </div>
        <div class="hint warn-strong" id="hintMobile">
          ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô MetaMask App (Browser ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° WalletConnect
        </div>
      </div>

      <!-- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô -->
      <div id="unlocked" class="gate hidden">
        <strong class="ok" id="unlockedTitle">üéâ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</strong>
        <div class="hint" id="hintUnlocked">‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∑‡∏≠ NFT ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‚Äî ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ</div>
        <div class="linkbox">
          <a class="btn" target="_blank" rel="noopener"
             href="https://ipfs.io/ipfs/bafybeic5vlbjz7g2ddyk7qzhb3lgrpvadxtxnixztxm26r2x4gsm3dzjwe" id="btnIpfs1">
             ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å ipfs.io
          </a>
          <a class="btn" target="_blank" rel="noopener"
             href="https://cloudflare-ipfs.com/ipfs/bafybeic5vlbjz7g2ddyk7qzhb3lgrpvadxtxnixztxm26r2x4gsm3dzjwe" id="btnIpfs2">
             ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å cloudflare-ipfs
          </a>
        </div>
        <div class="hint" id="hintOneTime">‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÇ‡∏õ‡∏£‡∏î‡∏±‡∏Å‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏£‡∏≠‡∏≠‡∏Å one‚Äëtime download link ‡∏à‡∏≤‡∏Å backend</div>
      </div>
    </div>
  </div>

  <script>
    // ===== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢/‡∏™‡∏±‡∏ç‡∏ç‡∏≤ =====
    const CHAIN_ID_DEC = 137;                  // Polygon Mainnet
    const CHAIN_ID_HEX = "0x89";
    // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô "‡πÉ‡∏î‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á" ‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ (ERC‚Äë721)
    const COLLECTIONS_ERC721 = [
      "0xefc87d60fc234d87286d41c5143b25c1abf38477",
      "0x76f4E59DBBF99D025B6F1014D33843AB138e4085"
    ];
    // WalletConnect Project ID (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡∏°‡∏≤)
    const WC_PROJECT_ID = "0x76f4E59DBBF99D025B6F1014D33843AB138e4085";

    // ABI ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ (ERC‚Äë165 ‡∏ï‡∏£‡∏ß‡∏à‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô + ERC‚Äë721 balanceOf)
    const ABI = [
      "function supportsInterface(bytes4 interfaceId) view returns (bool)",
      "function balanceOf(address owner) view returns (uint256)"
    ];
    const IERC721_ID = "0x80ac58cd"; // interfaceId ‡∏Ç‡∏≠‡∏á ERC‚Äë721

    // ===== i18n (‡∏™‡∏≠‡∏á‡∏†‡∏≤‡∏©‡∏≤) =====
    let LANG = "th";
    const t = {
      th: {
        title: "üîí ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ñ‡∏∑‡∏≠ ‚Äî ERC‚Äë721",
        pillNet: "Network: Polygon (137 / 0x89)",
        pillStd: "ERC‚Äë721 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô",
        connectMM: "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ MetaMask",
        connectWC: "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢ WalletConnect",
        statusIdle: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠",
        locked: "Locked",
        hintReq: "‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏∑‡∏≠ NFT ‡∏à‡∏≤‡∏Å <b>‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡πÉ‡∏î‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á</b> (ERC‚Äë721) ‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î",
        hintMobile: "‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô MetaMask App (Browser ‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° WalletConnect",
        unlocked: "üéâ ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß",
        hintUnlocked: "‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∑‡∏≠ NFT ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‚Äî ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ",
        ipfs1: "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å ipfs.io",
        ipfs2: "‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å cloudflare-ipfs",
        oneTime: "‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÇ‡∏õ‡∏£‡∏î‡∏±‡∏Å‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏£‡∏≠‡∏≠‡∏Å one‚Äëtime download link ‡∏à‡∏≤‡∏Å backend",
        statusNetWrong: (addr, cid)=>`‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö ${addr} ‡πÅ‡∏ï‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Polygon (chainId=${cid})`,
        statusChecking: (addr)=>`‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ${addr} (Polygon) ‚Äî ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå...`,
        statusHas: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏•‡πâ‡∏ß: ‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏∑‡∏≠ NFT ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‚úÖ",
        statusNo: "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏∑‡∏≠ NFT ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‚ùå",
        statusNot721: "‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö ERC‚Äë721 ‚Äî ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ERC‚Äë721 ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô",
        statusMMFail: "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MetaMask ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        statusWCFail: "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ WalletConnect ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        alertNoMM: "‡πÑ‡∏°‡πà‡∏û‡∏ö MetaMask ‚Äî ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° WalletConnect ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô MetaMask App"
      },
      en: {
        title: "üîí Token‚ÄëGated Download ‚Äî ERC‚Äë721",
        pillNet: "Network: Polygon (137 / 0x89)",
        pillStd: "ERC‚Äë721 only",
        connectMM: "Connect with MetaMask",
        connectWC: "Connect with WalletConnect",
        statusIdle: "Not connected",
        locked: "Locked",
        hintReq: "You must hold an NFT from <b>either collection</b> (ERC‚Äë721) above to see the download link.",
        hintMobile: "On mobile, use the MetaMask in‚Äëapp browser or the WalletConnect button.",
        unlocked: "üéâ Unlocked",
        hintUnlocked: "Ownership verified ‚Äî you can download the file.",
        ipfs1: "Download via ipfs.io",
        ipfs2: "Download via cloudflare‚Äëipfs",
        oneTime: "Tip: In production, issue a one‚Äëtime download link from your backend.",
        statusNetWrong: (addr, cid)=>`Connected ${addr} but network is not Polygon (chainId=${cid})`,
        statusChecking: (addr)=>`Connected: ${addr} (Polygon) ‚Äî verifying ownership...`,
        statusHas: "Ownership verified for one of the collections ‚úÖ",
        statusNo: "No eligible NFT detected for the specified collections ‚ùå",
        statusNot721: "Contract does not behave like ERC‚Äë721 ‚Äî this page is locked to ERC‚Äë721 only.",
        statusMMFail: "MetaMask connection failed",
        statusWCFail: "WalletConnect failed",
        alertNoMM: "MetaMask not found ‚Äî use WalletConnect or open in the MetaMask in‚Äëapp browser"
      }
    };

    function applyLang() {
      document.getElementById("title").textContent = t[LANG].title;
      document.getElementById("pillNet").textContent = t[LANG].pillNet;
      document.getElementById("pillStd").textContent = t[LANG].pillStd;
      document.getElementById("connectMeta").textContent = t[LANG].connectMM;
      document.getElementById("connectWC").textContent  = t[LANG].connectWC;
      document.getElementById("status").textContent = t[LANG].statusIdle;
      document.getElementById("lockedTitle").textContent = t[LANG].locked;
      document.getElementById("hintReq").innerHTML = t[LANG].hintReq;
      document.getElementById("hintMobile").textContent = t[LANG].hintMobile; // ‡∏Ñ‡∏á‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡∏≤/‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏•‡∏≤‡∏™
      document.getElementById("unlockedTitle").textContent = t[LANG].unlocked;
      document.getElementById("hintUnlocked").textContent = t[LANG].hintUnlocked;
      document.getElementById("btnIpfs1").textContent = t[LANG].ipfs1;
      document.getElementById("btnIpfs2").textContent = t[LANG].ipfs2;
      document.getElementById("hintOneTime").textContent = t[LANG].oneTime;
      document.getElementById("langBtn").textContent = (LANG==="th"?"EN":"TH");
    }

    document.getElementById("langBtn").addEventListener("click", ()=>{
      LANG = (LANG==="th" ? "en" : "th");
      applyLang();
    });

    // ===== DOM refs =====
    const $ = (id) => document.getElementById(id);
    const elStatus = $("status");
    const elLocked = $("locked");
    const elUnlocked = $("unlocked");

    // ===== Helpers =====
    function setStatus(msg, asOk=false, asErr=false){
      elStatus.classList.remove("ok","err");
      if(asOk) elStatus.classList.add("ok");
      if(asErr) elStatus.classList.add("err");
      elStatus.textContent = msg;
    }
    async function ensureChain(provider){
      try{
        await provider.send("wallet_switchEthereumChain", [{ chainId: CHAIN_ID_HEX }]);
      }catch(e){ /* ignore */ }
    }
    function showLocked(){ elLocked.classList.remove("hidden"); elUnlocked.classList.add("hidden"); }
    function showUnlocked(){ elLocked.classList.add("hidden"); elUnlocked.classList.remove("hidden"); }

    // ===== ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå: ‡∏ñ‡∏∑‡∏≠‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô "‡πÉ‡∏î‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡∏Å‡∏ä‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á" ‡∏Å‡πá‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å =====
    async function checkOwnership(provider){
      const web3 = new ethers.providers.Web3Provider(provider, "any");
      await ensureChain(web3);
      const signer = web3.getSigner();
      const addr = await signer.getAddress();

      const net = await web3.getNetwork();
      if (net.chainId !== CHAIN_ID_DEC){
        setStatus(t[LANG].statusNetWrong(addr, net.chainId), false, true);
        showLocked();
        return;
      }

      setStatus(t[LANG].statusChecking(addr));

      let hasAny = false;

      for (const caddr of COLLECTIONS_ERC721) {
        const contract = new ethers.Contract(caddr, ABI, web3);

        // ‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ supportsInterface (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ï‡πà‡∏≠)
        let isErc721 = false;
        try{
          isErc721 = await contract.supportsInterface(IERC721_ID);
        }catch(e){
          isErc721 = true; // ‡∏ö‡∏≤‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡πÑ‡∏°‡πà implement ERC165 ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏ä‡πâ balanceOf ‡πÑ‡∏î‡πâ
        }
        if (!isErc721) continue;

        try{
          const bal = await contract.balanceOf(addr);
          if (ethers.BigNumber.from(bal).gt(0)) {
            hasAny = true;
            break;
          }
        }catch(e){
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà ERC721 ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö balanceOf(owner)
          // ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
        }
      }

      if (hasAny){
        setStatus(t[LANG].statusHas, true, false);
        showUnlocked();
      }else{
        setStatus(t[LANG].statusNo, false, true);
        showLocked();
      }
    }

    // ===== ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ =====
    $("connectMeta").addEventListener("click", async()=>{
      if (!window.ethereum){
        alert(t[LANG].alertNoMM);
        return;
      }
      try{
        const provider = new ethers.providers.Web3Provider(window.ethereum, "any");
        await provider.send("eth_requestAccounts", []);
        await checkOwnership(window.ethereum);
      }catch(e){
        console.error(e);
        setStatus(t[LANG].statusMMFail, false, true);
      }
    });

    $("connectWC").addEventListener("click", async()=>{
      try{
        const wc = await window.WalletConnectEthereumProvider.init({
          projectId: WC_PROJECT_ID,
          chains: [CHAIN_ID_DEC],
          optionalChains: [CHAIN_ID_DEC],
          showQrModal: true,
          methods: [
            "eth_requestAccounts","eth_sendTransaction",
            "personal_sign","eth_signTypedData","eth_signTypedData_v4","eth_sign"
          ],
          rpcMap: { [CHAIN_ID_DEC]: "https://polygon-rpc.com" }
        });
        await wc.enable();
        await checkOwnership(wc);
      }catch(e){
        console.error(e);
        setStatus(t[LANG].statusWCFail, false, true);
      }
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏†‡∏≤‡∏©‡∏≤/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    applyLang();
    showLocked();
  </script>
</body>
</html>
