<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thronedis Gate ‚Äì Multi‚ÄëWallet (IDs 0‚Äì10)</title>

  <!-- Ethers -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <!-- Web3Modal (WalletConnect v2) Standalone UMD -->
  <script src="https://unpkg.com/@web3modal/standalone@2.7.2/dist/index.umd.js"></script>

  <style>
    :root { --bg:#0b0f14; --panel:#0f172a; --muted:#93a3b8; --brand:#2563eb; --ok:#16a34a; --bad:#ef4444; }
    * { box-sizing:border-box }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; background:var(--bg); color:#e9f0f4; margin:0; padding:24px; }
    h1, h2 { margin: 0 0 8px }
    a { color:#67e8f9; font-weight:600; text-decoration:none }
    .wrap { max-width:880px; margin:0 auto; }
    .card { background:var(--panel); border:1px solid #1f2937; border-radius:14px; padding:18px; margin-top:20px; }
    #secret { display:none; }
    #locked { margin-top:16px; }
    button { padding:10px 16px; border-radius:10px; border:0; cursor:pointer; background:var(--brand); color:white }
    .muted { color:var(--muted); }
    code { background:#111827; padding:2px 6px; border-radius:6px }
    .btn-row { display:flex; gap:12px; flex-wrap:wrap; margin-top:10px; }
    .btn-secondary { background:#334155; }
    .btn-danger { background:var(--bad); }
    ul.addr-list { list-style:none; padding:0; margin:10px 0 0; }
    ul.addr-list li { display:flex; align-items:center; gap:8px; padding:8px 0; border-top:1px solid #1f2937; }
    .pill { font-size:12px; padding:2px 8px; border-radius:999px; background:#334155; }
    .ok { background:rgba(22,163,74,.15); color:#86efac; }
    .bad { background:rgba(239,68,68,.15); color:#fecaca; }
  </style>
</head>
<body>
<div class="wrap">
  <h2>üîê Thronedis ‚Äì Token Gated (‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏™‡∏•‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤)</h2>
  <div class="muted">Polygon (137) ¬∑ Collection: <code>0x76f4E59DBBF99D025B6F1014D33843AB138e4085</code> ¬∑ Allowed IDs: <code>0‚Äì10</code></div>

  <div id="locked" class="card">
    <p>‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏∑‡∏≠ NFT ‡∏ó‡∏µ‡πà <strong>Token ID 0‚Äì10</strong> ‡πÉ‡∏ô‡∏Ñ‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏Å‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∂‡∏á‡∏à‡∏∞‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏î‡πâ</p>
    <div class="btn-row">
      <button id="btn-universal">üëú Connect / Add Wallet (Universal)</button>
      <button id="btn-metamask" class="btn-secondary">ü¶ä Add MetaMask (Desktop)</button>
      <a id="btn-mm-app" class="btn-secondary" style="display:inline-block; padding:10px 16px; border-radius:10px; background:#475569; color:white" target="_blank" rel="noopener">
        üì≤ Open in MetaMask App
      </a>
      <button id="btn-clear" class="btn-danger">üßπ Clear Connected</button>
    </div>
    <div id="accounts" class="muted" style="margin-top:10px;">
      <strong>Connected wallets:</strong>
      <ul class="addr-list" id="addr-list"></ul>
    </div>
    <p class="muted" style="margin-top:10px;">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚ÄúUniversal‚Äù ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡πá‡∏ï‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢ ‡πÜ (WalletConnect v2)</p>
  </div>

  <div id="secret" class="card">
    <h3>üéâ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß</h3>
    <p><a href="https://ipfs.io/ipfs/bafybeigsrytimlmv4dkz2px7ke4bwco4qj2kgxsdaeaxgmvkubiuexh5cu" target="_blank">üìÇ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏≤‡∏Å IPFS</a></p>
    <p class="muted">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: IPFS ‡πÄ‡∏õ‡πá‡∏ô public; ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏à‡∏Å one‚Äëtime link ‡∏ú‡πà‡∏≤‡∏ô backend</p>
  </div>
</div>

  <script>
    // ===== CONFIG =====
    const CONTRACT_ADDRESS = "0x76f4E59DBBF99D025B6F1014D33843AB138e4085";
    const NETWORK_HEX = "0x89"; // Polygon Mainnet
    const TOKEN_IDS = ["0","1","2","3","4","5","6","7","8","9","10"]; // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï 0‚Äì10
    const WALLETCONNECT_PROJECT_ID = "ba3a040708c3e27acefb4eb4b3c5d9a8";
    // ===================

    // ERC-165 interface ids
    const IID_ERC721  = "0x80ac58cd";
    const IID_ERC1155 = "0xd9b67a26";

    // Minimal ABIs
    const ABI_ERC165  = ["function supportsInterface(bytes4 interfaceId) view returns (bool)"];
    const ABI_ERC721  = ["function ownerOf(uint256 tokenId) view returns (address)"];
    const ABI_ERC1155 = ["function balanceOf(address account, uint256 id) view returns (uint256)"];

    const state = { entries: [] }; // { address, hasAccess, source }
    const addrListEl = document.getElementById("addr-list");

    // Deep link ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ô MetaMask Mobile
    const currentUrl = location.href;
    document.getElementById("btn-mm-app").href = "https://metamask.app.link/dapp/" + currentUrl.replace(/^https?:\/\//,'').replace(/\/+/g,'/');

    function short(a) { return a ? a.slice(0,6) + "‚Ä¶" + a.slice(-4) : ""; }

    function renderList() {
      addrListEl.innerHTML = "";
      state.entries.forEach((e) => {
        const li = document.createElement("li");
        const tag = document.createElement("span");
        tag.className = "pill " + (e.hasAccess ? "ok" : "bad");
        tag.textContent = e.hasAccess ? "has access" : "no access";
        li.innerHTML = `<span class="pill">${e.source}</span> <code>${e.address}</code>`;
        li.appendChild(tag);
        addrListEl.appendChild(li);
      });
      // ‡∏ñ‡πâ‡∏≤ wallet ‡πÉ‡∏î ‡πÜ ‡∏°‡∏µ access ‚Üí ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å
      const any = state.entries.some(e => e.hasAccess);
      document.getElementById("locked").style.display = any ? "none" : "block";
      document.getElementById("secret").style.display = any ? "block" : "none";
    }

    async function ensurePolygon(provider) {
      const chainId = await provider.request({ method: "eth_chainId" });
      if (chainId !== NETWORK_HEX) {
        await provider.request({
          method: "wallet_switchEthereumChain",
          params: [{ chainId: NETWORK_HEX }]
        });
      }
    }

    async function detectStandard(provider) {
      const web3p = new ethers.providers.Web3Provider(provider);
      const c165 = new ethers.Contract(CONTRACT_ADDRESS, ABI_ERC165, web3p);
      try {
        const is721  = await c165.supportsInterface(IID_ERC721);
        const is1155 = await c165.supportsInterface(IID_ERC1155);
        if (is1155) return "ERC1155";
        if (is721)  return "ERC721";
      } catch (e) {}
      return "ERC721"; // fallback
    }

    async function verifyWithProvider(provider, sourceName) {
      await ensurePolygon(provider);
      const accounts = await provider.request({ method: "eth_requestAccounts" });
      const account = accounts[0];

      const web3p = new ethers.providers.Web3Provider(provider);
      const signer = web3p.getSigner();
      const standard = await detectStandard(provider);

      let hasAccess = false;
      if (standard === "ERC721") {
        const c = new ethers.Contract(CONTRACT_ADDRESS, ABI_ERC721, signer);
        for (const id of TOKEN_IDS) {
          try {
            const owner = await c.ownerOf(id);
            if (owner && owner.toLowerCase() === account.toLowerCase()) { hasAccess = true; break; }
          } catch (err) { /* token ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà mint ‚Üí ‡∏Ç‡πâ‡∏≤‡∏° */ }
        }
      } else {
        const c = new ethers.Contract(CONTRACT_ADDRESS, ABI_ERC1155, signer);
        for (const id of TOKEN_IDS) {
          try {
            const bal = await c.balanceOf(account, id);
            if (bal && ethers.BigNumber.from(bal).gt(0)) { hasAccess = true; break; }
          } catch (err) {}
        }
      }

      // ‡πÄ‡∏Å‡πá‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ address ‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏ó‡∏ô)
      const idx = state.entries.findIndex(e => e.address.toLowerCase() === account.toLowerCase());
      const entry = { address: account, hasAccess, source: sourceName };
      if (idx >= 0) state.entries[idx] = entry; else state.entries.push(entry);
      renderList();

      if (!hasAccess) alert("‚ùå " + short(account) + " ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå (‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏∑‡∏≠ Token ID 0‚Äì10)");
    }

    // --- MetaMask (Desktop) ---
    document.getElementById("btn-metamask").addEventListener("click", async () => {
      if (!window.ethereum) { alert("‡πÑ‡∏°‡πà‡∏û‡∏ö MetaMask (‡∏•‡∏≠‡∏á‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Universal ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢ MetaMask App)"); return; }
      await verifyWithProvider(window.ethereum, "MetaMask");
    });

    // --- Web3Modal (WalletConnect v2) ‚Äî Universal button ---
    const w3m = window.Web3ModalStandalone;
    let modal = null;
    function ensureWeb3Modal() {
      if (!WALLETCONNECT_PROJECT_ID) return null;
      if (!modal) {
        modal = w3m.default({
          projectId: WALLETCONNECT_PROJECT_ID,
          themeMode: "dark",
          walletConnectVersion: 2
        });
      }
      return modal;
    }

    document.getElementById("btn-universal").addEventListener("click", async () => {
      const m = ensureWeb3Modal();
      if (!m) { alert("Web3Modal ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ projectId"); return; }
      const provider = await m.connect();
      await verifyWithProvider(provider, "WalletConnect");
    });

    // --- Clear list ---
    document.getElementById("btn-clear").addEventListener("click", () => {
      state.entries = [];
      renderList();
    });

    // render ‡πÅ‡∏£‡∏Å
    renderList();
  </script>
</body>
</html>
```Ó®Å0Ó®Ç
